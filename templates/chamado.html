{% extends "layout.html" %}

{% block title %}Abrir Chamado{% endblock %}

{% block content %}
<h1>Abertura de Chamado Técnico</h1>

<div class="user-info">
    <div class="info-item">
        <label>Solicitante:</label>
        <input type="text" value="{{ user.responsavel }}" disabled>
    </div>
    <div class="info-item">
        <label>E-mail:</label>
        <input type="email" value="{{ user.email }}" disabled>
    </div>
    <div class="info-item">
        <label>Município:</label>
        <input type="text" value="{{ user.municipio }}" disabled>
    </div>
</div>

<form method="post" action="{{ url_for('submit_chamado') }}" enctype="multipart/form-data">
    <h2>Equipamentos</h2>
    <h3>Selecione o dispositivo que necessita do suporte</h3>
    <div id="imeiTableContainer">
        {% if equipamentos %}
            <table>
                <thead>
                    <tr>
                        <th>Selecionar</th>
                        <th>Patrimônio</th>
                        <th>IMEI 1</th>
                        <th>IMEI 2</th>
                        <th>Marca</th>
                        <th>Modelo</th>
                        <th>Nº de Série</th>
                        <th>Local de Uso</th>
                        <th>Situação</th>
                        <th>Data da Entrega</th>
                    </tr>
                </thead>
                <tbody>
                    {% for equipamento in equipamentos %}
                    <tr>
                        <td><input type="radio" name="selectedDevice" value="{{ equipamento.imei1 }}" required></td>
                        <td>{{ equipamento.patrimonio }}</td>
                        <td>{{ equipamento.imei1 }}</td>
                        <td>{{ equipamento.imei2 }}</td>
                        <td>{{ equipamento.marca }}</td>
                        <td>{{ equipamento.modelo }}</td>
                        <td>{{ equipamento.numeroDeSerie }}</td>
                        <td>{{ equipamento.localdeUso }}</td>
                        <td>{{ equipamento.situacao }}</td>
                        <td>
                            {% if equipamento.dataEntrega %}
                                {{ equipamento.dataEntrega.split(' ')[0].split('-') | reverse | join('/') }}
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p style="padding: 1em;">Nenhum equipamento disponível encontrado para este município.</p>
        {% endif %}
    </div>

    <hr>
    <h2>Informações do Chamado</h2>
    <div class="form-group">
        <label for="tipoProblema">Tipo de Chamado/Problema:</label>
        <select id="tipoProblema" name="tipoProblema" required>
            <option value="">-- Selecione uma Categoria --</option>
            <option value="Octostudio">Octostudio</option>
            <option value="Sistema Operacional">Sistema Operacional</option>
            <option value="Hardware/Dispositivo">Hardware/Dispositivo</option>
            <option value="Duvidas/Outros">Dúvidas/Outros</option>
        </select>
    </div>
    <div class="form-group">
        <label for="observacoes">Detalhamento do problema/solicitação:</label>
        <textarea id="observacoes" name="observacoes" rows="4" placeholder="Descreva o problema ou a solicitação..." required maxlength="300"></textarea>
    </div>

    <div class="form-group">
        <label for="foto">Anexar Foto (Opcional):</label>
        <input type="file" id="foto" name="foto" accept="image/png, image/jpeg, image/gif">
    </div>

    <button type="submit">Registrar Chamado</button>
</form>

{% endblock %}