{% extends "layout.html" %}

{% block title %}Abrir Chamado{% endblock %}

{% block content %}
<h1>Abertura de Chamado Técnico</h1>

<!-- Seção com os dados do usuário -->
<div class="user-info">
    <div class="info-item">
        <label>Solicitante:</label>
        <input type="text" value="{{ user.responsavel }}" disabled>
    </div>
    <div class="info-item">
        <label>Telefone:</label>
        <input type="tel" value="{{ user.telefone }}" disabled>
    </div>
    <div class="info-item">
        <label>E-mail:</label>
        <input type="email" value="{{ user.email }}" disabled>
    </div>
    <div class="info-item">
        <label>Município:</label>
        <input type="text" value="{{ user.municipio }}" disabled>
    </div>
</div>

<!-- Formulário para registrar o chamado -->
<form method="post" action="{{ url_for('submit_chamado') }}">
    <h2>Smartphones</h2>
    <h3>Selecione o dispositivo que necessita do suporte</h3>
    <div id="imeiTableContainer">
        {% if smartphones %}
            <table>
                <thead>
                    <tr>
                        <th>Selecionar</th>
                        <th>IMEI</th>
                        <th>Marca</th>
                        <th>Modelo</th>
                    </tr>
                </thead>
                <tbody>
                    {% for s in smartphones %}
                    <tr>
                        <td><input type="radio" name="selectedDevice" value="{{ s.imei }}" required></td>
                        <td>{{ s.imei }}</td>
                        <td>{{ s.marca }}</td>
                        <td>{{ s.modelo }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>Nenhum dispositivo disponível encontrado para este município.</p>
        {% endif %}
    </div>

    <hr>
    <h2>Informações do Chamado</h2>
    <div class="form-group">
        <label for="tipoProblema">Tipo de Chamado/Problema:</label>
        <select id="tipoProblema" name="tipoProblema" required>
            <option value="">-- Selecione uma Categoria --</option>
            <option value="Octostudio">Octostudio</option>
            <option value="Sistema Operacional">Sistema Operacional</option>
            <option value="Hardware/Dispositivo">Hardware/Dispositivo</option>
            <option value="Duvidas/Outros">Dúvidas/Outros</option>
        </select>
    </div>
    <div class="form-group">
        <label for="observacoes">Detalhamento do problema/solicitação:</label>
        <textarea id="observacoes" name="observacoes" rows="5" placeholder="Descreva o problema ou a solicitação..." required maxlength="300"></textarea>
    </div>
    <button type="submit">Registrar Chamado</button>
</form>

<!-- Seção para exibir chamados recentes -->
{% if chamados %}
<hr>
<h2>Últimos Chamados Registrados</h2>
<div id="imeiTableContainer">
    <table>
        <thead>
            <tr>
                <th>Data</th>
                <th>Tipo de Problema</th>
                <th>IMEI</th>
            </tr>
        </thead>
        <tbody>
            {% for chamado in chamados %}
            <tr>
                <td>{{ chamado.timestamp.split(' ')[0].split('-') | reverse | join('/') }}</td>
                <td>{{ chamado.tipo_problema }}</td>
                <td>{{ chamado.smartphone_imei }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

{% endblock %}
